{% extends 'layout_default.html.twig' %}

{% import 'macro_functions.html.twig' as mf %}

{% set active_menu = 'discord' %}

{% block meta_title %}{{ 'Discord Webhooks'|trans }}{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h3 class="card-title">{{ 'Discord Webhooks'|trans }}</h3>
        <div class="card-actions">
            <a href="{{ 'discord/webhook'|alink }}" class="btn btn-primary">
                <svg class="icon me-2">
                    <use xlink:href="#plus"/>
                </svg>
                {{ 'Create New Webhook'|trans }}
            </a>
        </div>
    </div>

    <div class="table-responsive">
        <table class="table card-table table-vcenter table-striped text-nowrap">
            <thead>
                <tr>
                    <th>{{ 'ID'|trans }}</th>
                    <th>{{ 'Webhook URL'|trans }}</th>
                    <th>{{ 'Events'|trans }}</th>
                    <th>{{ 'Status'|trans }}</th>
                    <th>{{ 'Created'|trans }}</th>
                    <th class="w-1"></th>
                </tr>
            </thead>
            <tbody>
                {% set webhooks = admin.discord_get_list %}
                {% for webhook in webhooks %}
                    <tr>
                        <td>{{ webhook.id }}</td>
                        <td>
                            <div class="text-truncate" style="max-width: 300px;" title="{{ webhook.url }}">
                                <code class="text-muted">{{ webhook.url }}</code>
                            </div>
                        </td>
                        <td>
                            {% if "all_events" in webhook.events %}
                                All events
                            {% else %}
                                {{ webhook.events|length }} {{ 'events'|trans }}
                            {% endif %}
                        </td>
                        <td>
                            {% if webhook.active %}
                                <span class="badge bg-success"></span> {{ 'Active'|trans }}
                            {% else %}
                                <span class="badge bg-danger"></span> {{ 'Inactive'|trans }}
                            {% endif %}
                        </td>
                        <td>{{ webhook.created_at|format_datetime }}</td>
                        <td>
                            <a class="btn btn-icon" href="{{ 'discord/webhook'|alink }}/{{ webhook.id }}"
                                data-bs-toggle="tooltip" data-bs-title="{{ 'Edit'|trans }}">
                                <svg class="icon">
                                    <use xlink:href="#edit" />
                                </svg>
                            </a>
                            <a href="{{ 'api/admin/discord/send_test_message'|link({ 'id': webhook.id }) }}"
                                class="btn btn-icon api-link" data-api-msg="{{ 'Successfully sent a test message.'|trans }}"
                                data-bs-toggle="tooltip" data-bs-title="{{ 'Send Test Message'|trans }}">
                                    <svg class="icon">
                                        <use xlink:href="#wifi"/>
                                    </svg>
                            </a>
                            <a href="{{ 'api/admin/discord/delete'|link({ 'id': webhook.id }) }}"
                                   class="btn btn-icon api-link"
                                   data-api-confirm="{{ 'Are you sure you want to delete this webhook?'|trans }}"
                                   data-api-confirm-btn="{{ 'Delete'|trans }}"
                                   data-api-confirm-btn-color="danger"
                                   data-api-reload="1"
                                   title="{{ 'Delete'|trans }}">
                                    <svg class="icon">
                                        <use xlink:href="#delete"/>
                                    </svg>
                                </a>
                        </td>
                    </tr>
                {% else %}
                    <tr>
                        <td colspan="6" class="text-center text-muted">
                            {{ 'No webhooks configured yet.'|trans }}
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}